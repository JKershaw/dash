<!-- Simple Footer -->
<footer class="mt-auto py-4 bg-light">
  <div class="container text-center text-muted small">
    <div>
      <span>Dash v<%= typeof version !== 'undefined' ? version : '1.0.0' %></span>
      <span id="update-notice" style="display: none;">
        <span class="mx-2">•</span>
        <a href="https://github.com/jkershaw/dash" class="text-success text-decoration-none fw-bold" target="_blank">
          <i class="bi bi-arrow-up-circle"></i> Update available
        </a>
      </span>
      <span id="latest-notice" style="display: none;">
        <span class="mx-2">•</span>
        <span class="text-success">
          <i class="bi bi-check-circle"></i> Latest version
        </span>
      </span>
      <span id="dev-notice" style="display: none;">
        <span class="mx-2">•</span>
        <span class="text-info">
          <i class="bi bi-wrench"></i> Dev version
        </span>
      </span>
      <span class="mx-2">•</span>
      <a href="https://github.com/jkershaw/dash" class="text-muted text-decoration-none" target="_blank">
        <i class="bi bi-github"></i> GitHub
      </a>
      <span class="mx-2">•</span>
      <a href="https://jkershaw.com" class="text-muted text-decoration-none" target="_blank">
        <i class="bi bi-person-circle"></i> J Kershaw
      </a>
      <span class="mx-2">•</span>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSebmRBzGk-3WQZZA6zMHOr3Q07tf6vA44fRHuK9b4dGpd6bZQ/viewform?usp=dialog" class="text-muted text-decoration-none" target="_blank">
        <i class="bi bi-chat-square-text"></i> Feedback
      </a>
    </div>
    <div class="mt-2 text-muted">
      <small>Beta software - Business/revenue-generating use requires permission</small>
    </div>
    <div class="mt-2">
      <img src="/public/icons/icon-192.png" alt="Dash Logo" class="footer-logo">
    </div>
  </div>
</footer>

<!-- Bootstrap 5.3.8 JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

<!-- D3.js 7.9.0 for charts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>

<!-- API Client Library (load first) -->
<script src="/public/js/api.js"></script>

<!-- Markdown Service (load after DOMPurify and markdown-it) -->
<script src="/public/js/markdown-service.js"></script>

<!-- Global JavaScript -->
<script src="/public/js/global.js"></script>

<!-- Version Check -->
<script>
function compareVersions(current, latest) {
  // Parse version strings into arrays of numbers
  const currentParts = current.split('.').map(Number);
  const latestParts = latest.split('.').map(Number);
  
  // Ensure both arrays have same length by padding with zeros
  const maxLength = Math.max(currentParts.length, latestParts.length);
  while (currentParts.length < maxLength) currentParts.push(0);
  while (latestParts.length < maxLength) latestParts.push(0);
  
  // Compare each part
  for (let i = 0; i < maxLength; i++) {
    if (currentParts[i] < latestParts[i]) return -1; // behind
    if (currentParts[i] > latestParts[i]) return 1;  // ahead
  }
  return 0; // same
}

async function checkForUpdates() {
  try {
    const response = await fetch('https://raw.githubusercontent.com/jkershaw/dash/main/package.json');
    const packageData = await response.json();
    
    const currentVersion = '<%= typeof version !== "undefined" ? version : "1.0.0" %>';
    const latestVersion = packageData.version;
    
    const comparison = compareVersions(currentVersion, latestVersion);
    
    if (comparison < 0) {
      // Behind - show update notice
      document.getElementById('update-notice').style.display = 'inline';
      document.getElementById('header-update-notice').style.display = 'inline';
    } else if (comparison === 0) {
      // Same - show latest version notice
      document.getElementById('latest-notice').style.display = 'inline';
    } else {
      // Ahead - show dev version notice
      document.getElementById('dev-notice').style.display = 'inline';
    }
  } catch (error) {
    // Silent failure - don't show anything if check fails
    console.log('Version check failed:', error);
  }
}

document.addEventListener('DOMContentLoaded', checkForUpdates);
</script>
</body>
</html>